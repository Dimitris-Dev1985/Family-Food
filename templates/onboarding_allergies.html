{% extends "base.html" %}
{% block title %}Αλλεργίες & Υλικά προς αποφυγή{% endblock %}
{% block content %}


<style>
.onboarding-screen {
  max-width: 420px;
  margin: 0;
  padding: 30px 18px 0 18px;
  background: var(--surface, #fffaf5);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}
.onboarding-header {
  margin-bottom: 16px;
  text-align: center;
  position: relative;
}
.onboarding-logo {
  display: block;
  margin: 0 auto 40px;
  width: 72px;
  height: 72px;
  border-radius: 16px;
  object-fit: cover;
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}

  
.onboarding-desc {
  font-size: 1.1em;
  color: #788484;
  margin-bottom: 16px;
}
.badge-options {
  display: flex;
  flex-wrap: wrap;
  gap: 10px 12px;
  margin-bottom: 14px;
  justify-content: center;
}
.badge-btn {
  background: var(--bg-badge);
  color: var(--brand);
  border: 1.3px solid #dbdbdb;
  border-radius: 24px;
  font-size: 1.1em;
  padding: 9px 19px;
  cursor: pointer;
  transition: background 0.13s, color 0.13s, border 0.13s;
  outline: none;
  font-weight: 500;
  user-select: none;
}
.badge-btn.selected,
.badge-btn:active {
  background: #e4f6e8;
  color: #1a6e38;
  border: 1.8px solid #218e46;
}

</style>


<div class="onboarding-screen">
  <div class="onboarding-header">
    <img src="/static/images/logo.png" class="onboarding-logo" alt="Family Food Logo">
    <h2>Έχεις αλλεργίες ή υλικά που θες να αποφύγεις;</h2>
    <p class="onboarding-desc">
      Διάλεξε από τα παρακάτω τις αλλεργίες ή υλικά που δε θες να εμφανίζονται στις προτεινόμενες συνταγές!
    </p>
  </div>

  <form class="allergy-form" method="post" autocomplete="off">
    <div class="badge-options">
      {% set badges = [
        "Ξηροί Καρποί", "Γλουτένη", "Γαλακτοκομικά", "Αυγό", "Σόγια", "Οστρακοειδή", "Ψάρι", "Σέλινο", "Μουστάρδα", "Σουσάμι", "Σιτάρι", "Φιστίκι"
      ] %}
      {% for badge in badges %}
        <button type="button"
          class="badge-btn{% if allergies and badge in allergies %} selected{% endif %}"
          data-value="{{ badge }}"
        >{{ badge }}</button>
      {% endfor %}
    </div>
    <input type="hidden" name="allergies" id="allergies-input" value="{{ ','.join(allergies or []) }}">

    <div class="onboarding-tip">
      Δεν βρήκες αυτό που ψάχνεις; Μην ανησυχείς, θα μπορείς να το προσθέσεις αργότερα στο προφίλ σου!
    </div>

    <div class="onboarding-actions-row">
      <button type="button" class="onboarding-back-btn" onclick="window.location='/onboarding_diet'">
        <span class="back-arrow">&#8592;</span>
        Πίσω
      </button>
      <button class="onboarding-next-btn" type="submit">Επόμενο</button>
    </div>
  </form>
</div>



<script>
let selected = new Set({% if allergies %}{{ allergies|tojson }}{% else %}[]{% endif %});
document.querySelectorAll('.badge-btn').forEach(function(btn){
  btn.addEventListener('click', function(e){
    e.preventDefault();
    const val = btn.getAttribute('data-value');
    if (btn.classList.contains('selected')) {
      btn.classList.remove('selected');
      selected.delete(val);
    } else {
      btn.classList.add('selected');
      selected.add(val);
    }
    document.getElementById('allergies-input').value = Array.from(selected).join(',');
  });
});
</script>

{% endblock %}
