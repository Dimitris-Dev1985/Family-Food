<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Test AI Suggest Dish</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, textarea {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
    }
    pre {
      background-color: #f5f5f5;
      padding: 15px;
      margin-top: 20px;
      border: 1px solid #ddd;
      max-height: 400px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ”¬ AI Suggest Dish Test</h1>

  <label>â±ï¸ max_time (Î»ÎµÏ€Ï„Î¬):</label>
  <input type="number" id="maxTime" value="90">

  <label>ğŸ² ÎºÏÏÎ¹Î¿ Ï…Î»Î¹ÎºÏŒ (mainIngredient):</label>
  <input type="text" id="ingredient" value="ÏˆÎ±ÏÎ¹">

  <label>ğŸš« excluded Ï…Î»Î¹ÎºÎ¬ (Ï‡Ï‰ÏÎ¹ÏƒÎ¼Î­Î½Î± Î¼Îµ ÎºÏŒÎ¼Î¼Î±):</label>
  <input type="text" id="excluded" placeholder="Ï€.Ï‡. Ï„Ï…ÏÎ¯, Î±Ï…Î³ÏŒ">

	<label>ğŸ”¥ Î•Ï€Î¹Î»Î¿Î³Î® Î¼ÎµÎ¸ÏŒÎ´Ï‰Î½ Î¼Î±Î³ÎµÎ¹ÏÎ­Î¼Î±Ï„Î¿Ï‚:</label>
	<div id="method-checkboxes" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 5px; margin-top: 5px;">
	  <label><input type="checkbox" value="Î¦Î¿ÏÏÎ½Î¿Ï‚"> Î¦Î¿ÏÏÎ½Î¿Ï‚</label>
	  <label><input type="checkbox" value="ÎšÎ±Ï„ÏƒÎ±ÏÏŒÎ»Î±"> ÎšÎ±Ï„ÏƒÎ±ÏÏŒÎ»Î±</label>
	  <label><input type="checkbox" value="Î§ÏÏ„ÏÎ±"> Î§ÏÏ„ÏÎ±</label>
	  <label><input type="checkbox" value="Î¤Î·Î³Î¬Î½Î¹"> Î¤Î·Î³Î¬Î½Î¹</label>
	  <label><input type="checkbox" value="Î£Ï‡Î¬ÏÎ±"> Î£Ï‡Î¬ÏÎ±</label>
	  <label><input type="checkbox" value="Air-fryer"> Air-fryer</label>
	</div>

  <label>ğŸ‘¨â€ğŸ³ ÏƒÎµÏ† (chef):</label>
  <input type="text" id="chef" placeholder="Ï€.Ï‡. Î“Î¹ÏÏÎ³Î¿Ï‚">

  <button onclick="sendRequest()">â–¶ï¸ Î•ÎºÏ„Î­Î»ÎµÏƒÎ·</button>
  
  <button onclick="clearSuggestions()" style="background-color: #e74c3c; color: white; margin-left: 10px;">
  ğŸ—‘ï¸ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î ÏÎ¿Ï„ÎµÎ¹Î½ÏŒÎ¼ÎµÎ½Ï‰Î½
  </button>

  <pre id="output">[Î‘Î½Î±Î¼Î¿Î½Î® Î³Î¹Î± Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±]</pre>

  <script>
  function sendRequest() {
      const maxTime = parseInt(document.getElementById("maxTime").value);
      const ingredient = document.getElementById("ingredient").value.trim();
      const excludedText = document.getElementById("excluded").value.trim();
      
      const chef = document.getElementById("chef").value.trim();

	const methodCheckboxes = document.querySelectorAll("#method-checkboxes input[type=checkbox]");
	const selectedMethods = Array.from(methodCheckboxes)
	  .filter(cb => cb.checked)
	  .map(cb => cb.value);

	// âœ… Debug ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·
	console.log("[DEBUG] Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ Î¼Î­Î¸Î¿Î´Î¿Î¹:", selectedMethods);
	document.getElementById("output").textContent = "[DEBUG] Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ Î¼Î­Î¸Î¿Î´Î¿Î¹: " + selectedMethods.join(", ");
	  


      const filters = {
        max_time: maxTime,
        ingredient: ingredient
      };

      if (excludedText) {
        filters.excluded = excludedText.split(",").map(e => e.trim());
      }
	  
	if (selectedMethods.length > 0 && selectedMethods.length < 6) {
	  filters.preferredMethod = selectedMethods;
	}

      if (chef) {
        filters.chef = chef;
      }

      const payload = {
        step: 3,
        filters: filters
      };

      fetch("/ai_suggest_dish", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
        .then(res => res.json())
        .then(data => {
          document.getElementById("output").textContent = JSON.stringify(data, null, 2);
        })
        .catch(err => {
          document.getElementById("output").textContent = "Î£Ï†Î¬Î»Î¼Î±: " + err;
        });
    }
	function clearSuggestions() {
	  fetch("/clear_suggestions", {
		method: "POST"
	  })
	  .then(res => res.json())
	  .then(data => {
		alert(data.message || "ÎšÎ±Î¸Î±ÏÎ¯ÏƒÏ„Î·ÎºÎ±Î½.");
		console.log("[DEBUG] ğŸ”", data);
	  })
	  .catch(err => {
		alert("Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î¿Î½ ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒ.");
		console.error("[ERROR]", err);
	  });
	}

  </script>
</body>
</html>
