<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Test AI Suggest Dish</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, textarea {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
    }
    pre {
      background-color: #f5f5f5;
      padding: 15px;
      margin-top: 20px;
      border: 1px solid #ddd;
      max-height: 400px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <h1>🔬 AI Suggest Dish Test</h1>

  <label>⏱️ max_time (λεπτά):</label>
  <input type="number" id="maxTime" value="90">

  <label>🍲 κύριο υλικό (mainIngredient):</label>
  <input type="text" id="ingredient" value="ψαρι">

  <label>🚫 excluded υλικά (χωρισμένα με κόμμα):</label>
  <input type="text" id="excluded" placeholder="π.χ. τυρί, αυγό">

	<label>🔥 Επιλογή μεθόδων μαγειρέματος:</label>
	<div id="method-checkboxes" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 5px; margin-top: 5px;">
	  <label><input type="checkbox" value="Φούρνος"> Φούρνος</label>
	  <label><input type="checkbox" value="Κατσαρόλα"> Κατσαρόλα</label>
	  <label><input type="checkbox" value="Χύτρα"> Χύτρα</label>
	  <label><input type="checkbox" value="Τηγάνι"> Τηγάνι</label>
	  <label><input type="checkbox" value="Σχάρα"> Σχάρα</label>
	  <label><input type="checkbox" value="Air-fryer"> Air-fryer</label>
	</div>

  <label>👨‍🍳 σεφ (chef):</label>
  <input type="text" id="chef" placeholder="π.χ. Γιώργος">

  <button onclick="sendRequest()">▶️ Εκτέλεση</button>
  
  <button onclick="clearSuggestions()" style="background-color: #e74c3c; color: white; margin-left: 10px;">
  🗑️ Καθαρισμός Προτεινόμενων
  </button>

  <pre id="output">[Αναμονή για αποτελέσματα]</pre>

  <script>
  function sendRequest() {
      const maxTime = parseInt(document.getElementById("maxTime").value);
      const ingredient = document.getElementById("ingredient").value.trim();
      const excludedText = document.getElementById("excluded").value.trim();
      
      const chef = document.getElementById("chef").value.trim();

	const methodCheckboxes = document.querySelectorAll("#method-checkboxes input[type=checkbox]");
	const selectedMethods = Array.from(methodCheckboxes)
	  .filter(cb => cb.checked)
	  .map(cb => cb.value);

	// ✅ Debug εμφάνιση
	console.log("[DEBUG] Επιλεγμένες μέθοδοι:", selectedMethods);
	document.getElementById("output").textContent = "[DEBUG] Επιλεγμένες μέθοδοι: " + selectedMethods.join(", ");
	  


      const filters = {
        max_time: maxTime,
        ingredient: ingredient
      };

      if (excludedText) {
        filters.excluded = excludedText.split(",").map(e => e.trim());
      }
	  
	if (selectedMethods.length > 0 && selectedMethods.length < 6) {
	  filters.preferredMethod = selectedMethods;
	}

      if (chef) {
        filters.chef = chef;
      }

      const payload = {
        step: 3,
        filters: filters
      };

      fetch("/ai_suggest_dish", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
        .then(res => res.json())
        .then(data => {
          document.getElementById("output").textContent = JSON.stringify(data, null, 2);
        })
        .catch(err => {
          document.getElementById("output").textContent = "Σφάλμα: " + err;
        });
    }
	function clearSuggestions() {
	  fetch("/clear_suggestions", {
		method: "POST"
	  })
	  .then(res => res.json())
	  .then(data => {
		alert(data.message || "Καθαρίστηκαν.");
		console.log("[DEBUG] 🔁", data);
	  })
	  .catch(err => {
		alert("Σφάλμα κατά τον καθαρισμό.");
		console.error("[ERROR]", err);
	  });
	}

  </script>
</body>
</html>
