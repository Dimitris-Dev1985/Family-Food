{% extends "base.html" %}
{% block content %}


<div class="d-flex justify-content-center mb-3">
  <h2 class="fw-bold mb-1" style="font-size:1.8em;">⚙️ Ρυθμίσεις</h2>
</div>

<form method="POST" id="settings-form" style="padding-left: 0.5em!important;">
    <!-- Διακόπτης Reset Onboarding -->
	<div class="form-check form-switch mb-4 d-flex align-items-center gap-2" style="padding-left: 0!important;">
	  <label class="form-check-label" for="reset_onboarding">Επαναφορά οδηγιών πρώτης χρήσης:</label>
	  <input class="form-check-input ms-2" type="checkbox" id="reset_onboarding" name="reset_onboarding">
	</div>


    <!-- Επιλογή πρώτης ημέρας εβδομάδας -->
    <div class="mb-4">
      <label for="menu_1st_day" class="form-label">Πρώτη μέρα εβδομαδιαίου μενού:</label>
      <select class="form-select" id="menu_1st_day" name="menu_1st_day" style="width: auto;">
        {% for i, day in [(1, 'Δευτέρα'), (2, 'Τρίτη'), (3, 'Τετάρτη'), (4, 'Πέμπτη'), (5, 'Παρασκευή'), (6, 'Σάββατο'), (7, 'Κυριακή')] %}
          <option value="{{ i }}" {% if user.menu_1st_day == i %}selected{% endif %}>{{ day }}</option>
        {% endfor %}
      </select>
    </div>

    <button type="submit" class="btn btn-primary">💾 Αποθήκευση</button>
  </form>

{% endblock %}



{% block scripts %}

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <script>
      {% for category, message in messages %}
        showAlert("{{ message }}", "{{ category }}", 2000, "center");
      {% endfor %}
    </script>
  {% endif %}
{% endwith %}

<script>
  const switchEl = document.getElementById("reset_onboarding");

  // Επανενεργοποίηση αν είχε ενεργοποιηθεί πριν (μόνο αν είμαστε στο /settings)
  if (location.pathname === "/settings" && localStorage.getItem("reset_temp") === "on") {
    switchEl.checked = true;
  }

  // Όταν ο χρήστης το αλλάζει, το καταγράφουμε προσωρινά
  switchEl.addEventListener("change", () => {
    if (switchEl.checked) {
      localStorage.setItem("reset_temp", "on");
    } else {
      localStorage.removeItem("reset_temp");
    }
  });

  // Καθαρίζουμε το localStorage όταν φορτώνει η σελίδα (κρατάμε μόνο όσο είναι ανοιχτή)
  window.addEventListener("load", () => {
    if (location.pathname === "/settings") {
      setTimeout(() => localStorage.removeItem("reset_temp"), 500);
    }
  });
</script>

{% endblock %}
